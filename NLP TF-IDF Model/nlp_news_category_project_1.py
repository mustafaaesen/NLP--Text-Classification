# -*- coding: utf-8 -*-
"""NLP News Category Project-1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14L0HqXdaBt-CGp2-4Oz2XLtCxO1nyA9B
"""

#iÃ§erisinde 7kategoriden 42k veri bulunan
#Turkish Headlines  veri setinden

# Haber baÅŸlÄ±klarÄ±nÄ±n iÃ§eriklerine gÃ¶re kategrori
#tahmini yapmaya Ã§alÄ±ÅŸmak

from google.colab import files

# BilgisayarÄ±ndan dosya yÃ¼kleme saÄŸlar
uploaded = files.upload()

import pandas as pd

# Dosya adÄ±nÄ± doÄŸru yazman Ã¶nemli!
df = pd.read_csv("TurkishHeadlines.csv")

# Ä°lk birkaÃ§ satÄ±rÄ± gÃ¶ster
df.head()

#Veri temizliÄŸi ve kÃ¼Ã§Ã¼k harfe Ã§evirme

import pandas as pd
import re
from sklearn.model_selection import train_test_split
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.naive_bayes import MultinomialNB
from sklearn.metrics import accuracy_score,classification_report

df = pd.read_csv("TurkishHeadlines.csv")
#dosyayÄ± okuma


df.dropna(inplace=True)
#eksik veri varsa silme

def temizle(metin): #metindlerde yapÄ±lacak iÅŸlemlerin fonksiyonel hale getirimi

  metin = metin.lower()  #kÃ¼Ã§Ã¼k harfe Ã§evirme
  metin = re.sub(r'[^\w\s]', '',metin)#noktalama iÅŸareti kaldÄ±rma

  return metin


df["temiz_haberler"]= df["HABERLER"].apply(temizle)
#temizle fonksiyonun tÃ¼m veri setinde uygulanmasÄ±

df[["HABERLER", "temiz_haberler","ETIKET"]].head()
#Kontrol iÃ§in

#veri seti eksik veri olnlar silindi ve noktalama iÅŸaretleri kaldÄ±rÄ±lÄ±p veirler
#lower case formatÄ±na getirildi

""" TF-IDF VektÃ¶rleme+Model EÄŸitimi"""

X=df["temiz_haberler"]
y=df["ETIKET"]

#girdi ve etikerleri ayarlama


tfidf = TfidfVectorizer()
X_tfidf= tfidf.fit_transform(X)
#TF-IDF vektÃ¶rleme iÅŸlemi

X_train, X_test, y_train, y_test = train_test_split(X_tfidf, y, test_size= 0.2,random_state=42)
#EÄŸitim ve test verisi ayrÄ±mÄ±

model = MultinomialNB()
model.fit(X_train,y_train)
#naive bayes modeli kurulumu ve eÄŸitimi

y_pred = model.predict(X_test)
#Test verisiyle tahmin


print("DoÄŸruluk ORanÄ±:",accuracy_score(y_test,y_pred))
print("\nSÄ±nÄ±flandÄ±rma Raporu:\n",classification_report(y_test,y_pred))
#DoÄŸruluk metrikleri

!pip install wordcloud

#WordCloud OluÅŸturma

from wordcloud import WordCloud
import matplotlib.pyplot as plt

kategoriler= df["ETIKET"].unique()
#her kaategorideki baÅŸlÄ±klarÄ± bilrÅŸetirip wordcloud oluÅŸturur


for kategori in kategoriler:

  basliklar = df[df["ETIKET"]==kategori]["temiz_haberler"]
  #Kategoriye ait baÅŸlÄ±klarÄ±n seÃ§imi

  metin = " ".join(basliklar)
  #tÃ¼m baÅŸlÄ±klarÄ± tek string haline getirme

  wordcloud = WordCloud(width=800, height=400, background_color='white').generate(metin)
  #wordcloud nensnesi tÃ¼retme

  plt.figure(figsize=(10,5))
  plt.imshow(wordcloud,interpolation='bilinear')
  plt.axis('off')
  plt.title(f"{kategori} Kategorisi - Kelime Bulutu", fontsize=16)
  plt.show()

"""
En Ã§ok tekrarlayan kelimeler

"""

def temizle(metin):

  metin= metin.lower()
  metin = re.sub(r'[^\nw\s]', '',metin)

  return metin


# her baÅŸlÄ±ÄŸa gerekli temizlik ve iÅŸlemleri yapan temizle fonksiyonu


def kategori_tahmin_et(cumle):
  temiz = temizle(cumle)

  vektor=tfidf.transform([temiz])#TF-IDF vektÃ¶rleme

  tahmin = model.predict(vektor)#tahmin yapma

  print(f"\n Girilen BaÅŸlÄ±k : {cumle}")
  print(f"Tahmin Edilen Kategori: {tahmin[0]}"
  )


kategori_tahmin_et("FenerbahÃ§e yeni transferini duyurdu.")
kategori_tahmin_et("Bitcoin fiyatÄ± yÃ¼kseliÅŸe geÃ§ti.")
kategori_tahmin_et("BakanlÄ±k saÄŸlÄ±k reformlarÄ±nÄ± aÃ§Ä±kladÄ±.")

# Kategorilere gÃ¶re veri daÄŸÄ±lÄ±mÄ±nÄ± say
kategori_sayilari = df["ETIKET"].value_counts()

# YazdÄ±r
print(kategori_sayilari)

# Ä°stersen grafikle de gÃ¶sterebiliriz
import matplotlib.pyplot as plt

plt.figure(figsize=(8,5))
kategori_sayilari.plot(kind="bar", color="skyblue")
plt.title("Kategoriye GÃ¶re Haber SayÄ±sÄ±")
plt.xlabel("Kategori")
plt.ylabel("Haber SayÄ±sÄ±")
plt.xticks(rotation=45)
plt.grid(axis="y", linestyle="--", alpha=0.7)
plt.tight_layout()
plt.show()

"""
veri seti gayet daÄŸÄ±nÄ±k olmasÄ±na raÄŸmen 3 tahminden sadece 1 ini doÄŸru bilebildi

bunun sebebi kelime kelime bakmasÄ± n-gram ÅŸeklinde saÄŸlÄ±k reformu yeni transfer
gibi bakamamasÄ± bu ÅŸkeilde yaparak doÄŸruluk oranÄ±nÄ± artÄ±rabiliriz
"""
#TF-IDF'i ngram_range=(1,2) ile gÃ¼ncelleyelim:
#Bu, hem tekli kelimelere hem de ikili kelime gruplarÄ±na bakmamÄ±zÄ± saÄŸlar.

# TF-IDF'yi unigram yerine bigram dahil olacak ÅŸekilde gÃ¼ncelliyoruz
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.model_selection import train_test_split
from sklearn.naive_bayes import MultinomialNB
from sklearn.metrics import accuracy_score, classification_report



tfidf =TfidfVectorizer(ngram_range=(1,2))
#ngram_range bu ÅŸekilde hem tekli ikili jelime gruplaraÄ±na
#bakarak daha doÄŸru tahmin yapbilir

X=tfidf.fit_transform(df["temiz_haberler"])
y= df["ETIKET"]
#temizlenmiÅŸ haberleri vektÃ¶relleÅŸtirme

X_train, X_test, y_train, y_test =train_test_split(X, y, test_size=0.2, random_state=42)
#eÄŸitim ve test verisini ayÄ±rma

model=MultinomialNB()
model.fit(X_train, y_train)
#model tanÄ±mlama ve eÄŸitme

y_pred = model.predict(X_test)

print("Yeni Model -N-Gram ile EÄŸitildi")
print("DoÄŸruluk ORanÄ±: ",accuracy_score(y_test, y_pred))
print("\nSÄ±nÄ±flandÄ±rma Raporu:\n",classification_report(y_test, y_pred))

def kategori_tahmin_et():
    cumle = input("ğŸ”¤ Haber baÅŸlÄ±ÄŸÄ±nÄ± giriniz: ")
    temiz = temizle(cumle)
    vektor = tfidf.transform([temiz])
    tahmin = model.predict(vektor)
    print(f"\nğŸ“Œ Tahmin Edilen Kategori: {tahmin[0]}")

kategori_tahmin_et()

#Gene yanlÄ±ÅŸ kodlandÄ±rdÄ±
#veri seti yanlÄ±ÅŸ mÄ± Ã¶ÄŸreniyor diye fenerbahÃ§e etiketini aratalÄ±m

# FenerbahÃ§e geÃ§en tÃ¼m baÅŸlÄ±klarÄ± ve kategorilerini gÃ¶relim
fener = df[df["temiz_haberler"].str.contains("fenerbahÃ§e")]
print(fener["ETIKET"].value_counts())

# EÄŸitim verisini yeniden oluÅŸturuyoruz
X = df["temiz_haberler"]
y = df["ETIKET"]

# TF-IDF + N-gram (Ã¶nceki gibi)
tfidf = TfidfVectorizer(ngram_range=(1,2))
X_tfidf = tfidf.fit_transform(X)

# EÄŸitim ve test ayrÄ±mÄ± (veri indislerini saklayarak!)
from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test, idx_train, idx_test = train_test_split(
    X_tfidf, y, df.index, test_size=0.2, random_state=42
)

# EÄŸitim setine karÅŸÄ±lÄ±k gelen orijinal satÄ±rlar:
df_train = df.loc[idx_train]

# EÄŸitim verisinde "fenerbahÃ§e" geÃ§en kaÃ§ baÅŸlÄ±k var?
fener_train = df_train[df_train["temiz_haberler"].str.contains("fenerbahÃ§e")]
print(fener_train[["HABERLER", "ETIKET"]])
print("\nToplam:", len(fener_train), "adet FenerbahÃ§e baÅŸlÄ±ÄŸÄ± eÄŸitim verisinde var.")

from sklearn.linear_model import LogisticRegression

# AynÄ± TF-IDF verisini kullanÄ±yoruz (X_train, X_test vs.)
model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)

# Tahmin
y_pred = model.predict(X_test)

# Performans Ã¶lÃ§
print(" Logistic Regression Modeli")
print("DoÄŸruluk OranÄ±:", accuracy_score(y_test, y_pred))
print("\n SÄ±nÄ±flandÄ±rma Raporu:\n", classification_report(y_test, y_pred))

kategori_tahmin_et()

"""
GÃ¶rÃ¼ldÃ¼pÃ¼ Ã¼zere Ã¶nce ikili kelimelerde aradÄ±k doÄŸru sonuÃ§ vermedi

Daha sonra fenerabhÃ§e kelimesi eÄŸitim test verilerinde dengesi daÄŸÄ±lÄ±p
daÄŸÄ±lmadÄ±ÄŸÄ±na baktÄ±k ancak gene hatalÄ± tahminde bulundu


Bu sefer eÄŸitim modelini deÄŸiÅŸtiirp logistic regression yaptÄ±k
bu sefer farklÄ± buldu ancak gene hatalÄ± buldu

Bu veri setiyle, bu modellerle (Naive Bayes / Logistic Regression),

âŒ BaÄŸlama dayalÄ± cÃ¼mle tahmini yapamayÄ±z.
âœ… Ancak kelime bazlÄ± istatistiksel eÅŸleÅŸtirme yapÄ±labilir.


CÃ¼mle bazlÄ± Ã¶rnekler iÃ§in bir sonraki projede BERT tabanlÄ± TÃ¼rkÃ§e metin
sÄ±nÄ±flandÄ±rma modeliyle aynÄ± Ã¶rneÄŸi deneyelim

 TF-IDF gibi klasik yÃ¶ntemler hÃ¢lÃ¢ gerÃ§ek dÃ¼nyada kullanÄ±lÄ±yor mu?

Evet, hÃ¢lÃ¢ Ã§ok yaygÄ±n kullanÄ±lÄ±yor.
Ama nerede? â†’ â€œAnlam Ã§Ã¶zÃ¼mlemesi gerektirmeyenâ€ alanlarda.

 KULLANILDIÄI GERÃ‡EK DÃœNYA SENARYOLARI:
Uygulama	Neden TF-IDF yeterli?
E-posta spam filtresi	             â€œbedavaâ€, â€œÅŸimdi alâ€ gibi anahtar kelimeler belirgin
Basit etiketleme sistemleri	       Anahtar kelimeye gÃ¶re iÃ§erik Ã¶nerisi
DokÃ¼man arama motorlarÄ±	           TF-IDF skoru yÃ¼ksekse eÅŸleÅŸme mantÄ±klÄ±
KÃ¼tÃ¼phane otomasyon sistemleri	   Kitap baÅŸlÄ±klarÄ±/konularÄ± genellikle sabit Ã¶rÃ¼ntÃ¼lerde
Ã–n iÅŸleme / Ã¶nyÃ¼z filtreleri	     Daha bÃ¼yÃ¼k modelden Ã¶nce TF-IDF ile filtreleme yapÄ±labilir



"""